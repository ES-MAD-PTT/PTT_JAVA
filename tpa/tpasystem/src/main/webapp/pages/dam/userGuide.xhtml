<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:shiro="http://shiro.apache.org/tags"
	xmlns:f="http://java.sun.com/jsf/core"	
	template="/templates/template.xhtml">
	<ui:define name="metadata">
	</ui:define>
	<ui:define name="breadCrumbComponent">
		<p:breadCrumb id="path_page" style="margin-bottom:3px">
			<p:menuitem value="#{msg['menu_home']}" icon="ui-icon fa fa-home" style="bottom: -3px;left: 3px" url="/home.xhtml" />
			<p:menuitem value="#{msg['menu_dam']}" url="#" />
			<p:menuitem value="#{msg['menu_parameters']}" url="#" />
			<p:menuitem value="#{msg['menu_userGuide']}" url="/pages/dam/userGuides.xhtml" />
		</p:breadCrumb>
	</ui:define>
	<ui:define name="content">
		<h:form id="form" style="width:100%;height:98%;border-collapse:collapse" fullPage="true">
			<p:growl id="msgs" showDetail="true" life="5000"/>
			
            <p:layout widgetVar="userGuideLayout" style="width:100%;height:100%" showEffect="clip"  hideEffect="clip">
				<p:layoutUnit id="table_center_layout" position="center" resizable="false" closable="false" collapsible="false">

					<p:dataTable widgetVar="w_userGuide1"  id="userGuides1" var="userGuide" value="#{userGuideView.items}" reflow="true" editable="true"
					   	style="margin-bottom:20px;border-collapse:collapse"
					    paginator="true" rows="15"
					    scrollable="true"  scrollHeight="100%"  selection="#{userGuideView.selectedDelete}" rowKey="#{userGuide.idn_document}"
					    rowsPerPageTemplate="5,10,15,20,25, #{userGuideView.itemsSize}" >

							<f:facet name="header">
								<p:outputPanel style="height:25px">
									<p:commandButton id="toggler" type="button" value="Columns" style="float:right" icon="ui-icon-calculator" />
	        						<p:columnToggler datasource="userGuides1" trigger="toggler" style="width:200px"/>
	        						<shiro:hasPermission name="#{changeSystemView.system}.DAM.USER_GUIDE.ADD">
		        						<p:commandButton id="new" type="button" value="New Document" icon="ui-icon fa fa-save" style="float:right;"
		        							onclick="PF('dlgNewUserGuide').show();"/>
		        						<p:commandButton id="newDocument" type="button" rendered="#{userBean.isUser_type('OPERATOR')}" value="New Document Type" icon="ui-icon fa fa-save" style="float:right;"
		        							onclick="PF('dlgNewDocumentName').show();"/>
										<p:commandButton id="delete" value="#{msg['delete']}" style="float:right;"
											actionListener="#{userGuideView.deleteFile}"
											update=":form:msgs,:#{p:component('userGuides1')}"
											onstart="PF('grabando').show()"
											oncomplete="PF('grabando').hide()" />		        							
	        						</shiro:hasPermission>	
								</p:outputPanel>        										          
					        </f:facet>

							<p:column selectionMode="single" style="width:16px;text-align:center"/>
					        <p:column  headerText="#{msg['userGuide_Document_name']}" style="width: 80px;" sortBy="#{userGuide.type_desc}" filterMatchMode="contains" filterBy="#{userGuide.type_desc}">
					       		<h:outputText value="#{userGuide.type_desc}">			
					            </h:outputText>
					       </p:column>
						      
					       <p:column headerText="#{msg['userGuide_File']}" style="width: 220px;" sortBy="#{userGuide.document_name}">
							    <p:commandButton ajax="false" 
							    	oncomplete="PrimeFaces.monitorDownload(start, stop);" icon="ui-icon fa fa-save" title="#{userGuide.document_name}" >
									<f:setPropertyActionListener value="#{userGuide}" target="#{userGuideView.selected}" />
							        <p:fileDownload value="#{userGuideView.getTemplate(userGuide)}"/>
							    </p:commandButton>
								<h:outputText value="#{userGuide.document_name}" title="#{userGuide.document_name}" />							    
					       </p:column>
					       
					        <p:column   headerText="#{msg['userGuide_document_description']}" style="width: 220px;" sortBy="#{userGuide.version_comment}" filterMatchMode="contains" filterBy="#{userGuide.version_comment}">
					       		<p:inputTextarea readonly="true"  value="#{userGuide.version_comment}" cols="60" >	 		
					            </p:inputTextarea>
					       </p:column>
					       
					        <p:column  headerText="#{msg['userGuide_Last_Modiffied']}" style="width: 60px;" sortBy="#{userGuide.version_date}" filterMatchMode="contains" filterBy="#{userGuide.version_date}">       		
					            	<h:outputText value="#{userGuide.version_date}" >
					          				<f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss" />
					              	 </h:outputText>
					       </p:column>
					       
						      
					   </p:dataTable>
				</p:layoutUnit>

			</p:layout>
		</h:form>
		
		<shiro:hasPermission name="#{changeSystemView.system}.DAM.USER_GUIDE.ADD">
		<p:dialog widgetVar="dlgNewUserGuide" resizable="false"  closable="true" modal="true" appendTo="@(body)" header="New UserGuide">
		<!-- Este ajax es para que cunado cierre por el  aspa limpie el formulario
		 <p:ajax event="close" update="formNewEntity"  process="@this" listener="#{userGuideView.cancel}" />	-->
			<h:form id="formNewEntity">
			<p:growl id="msgs" showDetail="true"  life="5000"/>
				<p:panelGrid columns="4" style="width:100%">
					<p:panelGrid>
						<p:row>
							<p:column>
								<h:outputText value="#{msg['userGuide_Document_name']}" />
							</p:column>
							<p:column>
	        					
	        					<p:selectOneMenu required="true" id="type" style="width:50px" value="#{userGuideView.newUserGuide.idn_document_type}"
	        							requiredMessage="The mandatory field #{msg['userGuide_Type_Description']} must be informed">
										<!-- Con el boton de FileUpload no se actualiza este campo de newDocument. Hay que actualizarlo con ajax. -->
										<p:ajax event="change" update="type" />
										 <f:selectItem itemLabel=" " itemValue="" />	
		 								<f:selectItems value="#{userGuideView.documentDescription.entrySet()}" var="entry" itemValue="#{entry.key}"  itemLabel="#{entry.value}" />
			           			</p:selectOneMenu>	
			           			<p:message for="type" />		
							</p:column>	
							<p:column>
								<h:outputText value="#{msg['userGuide_File']}" />
							</p:column>
							<p:column>
		           				<p:fileUpload id="upload" style="width:100%" fileUploadListener="#{userGuideView.handleFileUpload}" 
								mode="advanced" dragDropSupport="true" allowTypes="/(\.|\/)(pdf|xls|xlsx|xlsm)$/" multiple="true" fileLimit="50" ajax="true" update=":form:msgs,:formNewEntity,:#{p:component('uploadedFiles')}"
		     					onstart="PF('cargando').show()" oncomplete="PF('cargando').hide()"/>
							</p:column>				
						</p:row>
						
						<p:row>
							<p:column >
								<h:outputText value="#{msg['uploaded_files']}"/>
							</p:column>
							<p:column colspan="3">
							
								<p:dataTable widgetVar="w_uploadedFiles"  id="uploadedFiles" var="file" value="#{userGuideView.list_files}" reflow="true"
								   	style="width:400px"
								    paginator="true" rows="5"
								    scrollable="true" 
								    rowsPerPageTemplate="5,10,15"
								     >
			
								       <p:column headerText="#{msg['userGuide_File']}" style="width: 320px;" sortBy="#{file.document_name}">
											<h:outputText value="#{file.document_name}" title="#{file.document_name}" />							    
								       </p:column>
									   <p:column style="width:40px" headerText="#{msg['delete']}">
								       		<p:commandButton icon="fa fa-remove" actionListener="#{userGuideView.remove(file)}" onstart="PF('cargando').show()"
												oncomplete="PF('cargando').hide()" update=":form:msgs,:formNewEntity,:#{p:component('uploadedFiles')}">  
							                </p:commandButton> 
							       </p:column>   
								   </p:dataTable>							
							
							
							</p:column>
						</p:row>
						
						
						
						<p:row>
							<p:column >
								<h:outputText value="#{msg['userGuide_document_description']}"/>
							</p:column>
							<p:column colspan="3">	
								<p:inputTextarea id="comments" value="#{userGuideView.newUserGuide.version_comment}" 
								 counter="display" maxlength="250" counterTemplate="#{msg['cr_man_char_remaining']}" cols="75"  >				
								<!-- Con el boton de FileUpload no se actualiza este campo de newDocument. Hay que actualizarlo con ajax. -->
								<p:ajax event="change" update="comments" />	
								</p:inputTextarea>
							</p:column>
					
						</p:row>	
						
						<p:row>
							<p:column colspan="2">
								<h:outputText id="display" />
							</p:column>
						</p:row>		
					
						<p:row>
							<p:column colspan="4" >
								<p:commandButton value="#{msg['cancel']}" style="float:right;"
										actionListener="#{userGuideView.cancel}" immediate="true"
										update=":form:msgs,:formNewEntity,:#{p:component('userGuides1')}"
										onstart="PF('cancelando').show()"
										oncomplete="PF('cancelando').hide();PF('dlgNewUserGuide').hide();" />										
								<p:commandButton value="#{msg['save']}" style="float:right;"
										actionListener="#{userGuideView.save}"
										update=":form:msgs,:formNewEntity,:#{p:component('userGuides1')}"
										onstart="PF('grabando').show()"
										oncomplete="PF('grabando').hide();PF('dlgNewUserGuide').hide();" />
								</p:column>
						</p:row>
					
					</p:panelGrid>
				</p:panelGrid>
				
				<p:separator/>
							
			</h:form>			
		</p:dialog>
	
	</shiro:hasPermission>

	<shiro:hasPermission name="#{changeSystemView.system}.DAM.USER_GUIDE.ADD">
		<p:dialog widgetVar="dlgNewDocumentName" resizable="false"  closable="true" modal="true" appendTo="@(body)" header="New Document Type">
		<!-- Este ajax es para que cunado cierre por el  aspa limpie el formulario
		 <p:ajax event="close" update="formNewEntity"  process="@this" listener="#{userGuideView.cancel}" />	-->
			<h:form id="formNewType">
			<p:growl id="msgs" showDetail="true"  life="5000"/>
				<p:panelGrid columns="4" style="width:100%">
					<p:panelGrid>
						<p:row>
							<p:column>
								<h:outputText value="#{msg['userGuide_document_code']}" />
							</p:column>
							<p:column>
								<p:inputText required="true" id="code" value="#{userGuideView.newDocument.code}"  maxlength="50"
									requiredMessage="#{msg['userGuide_document_code']}: #{msg['empty_field']}"
									validatorMessage="#{msg['userGuide_document_code']}: #{msg['lenght_field']} 50">
									 <f:validateLength maximum="50"/>
								</p:inputText>
								<p:message for="code" />
							</p:column>
							<p:column>
								<h:outputText value="#{msg['userGuide_document_desc']}" />
							</p:column>
							<p:column>
								<p:inputText required="true" id="desc" value="#{userGuideView.newDocument.desc}"  maxlength="250"
									requiredMessage="#{msg['userGuide_document_desc']}: #{msg['empty_field']}"
									validatorMessage="#{msg['userGuide_document_desc']}: #{msg['lenght_field']} 250">
									 <f:validateLength maximum="250"/>
								</p:inputText>
								<p:message for="desc" />
							</p:column>	
						</p:row>
						<p:row>			
							<p:column>
								<h:outputText value="#{msg['userGuide_document_role']}" />
							</p:column>
							<p:column>
	        					
	        					<p:selectOneMenu required="true" id="type" style="width:50px" value="#{userGuideView.newDocument.idn_user_group_type}"
	        							requiredMessage="The mandatory field #{msg['userGuide_document_role']} must be informed">
										<!-- Con el boton de FileUpload no se actualiza este campo de newDocument. Hay que actualizarlo con ajax. -->
										 <f:selectItem itemLabel=" " itemValue="" />	
		 								<f:selectItems value="#{userGuideView.userGroupType.entrySet()}" var="entry" itemValue="#{entry.key}"  itemLabel="#{entry.value}" />
			           			</p:selectOneMenu>	
			           			<p:message for="type" />		
							</p:column>	
							<p:column>
								<h:outputText value="#{msg['userGuide_is_user_guide']}" />
							</p:column>
							<p:column>
	        					
	        					<p:selectOneMenu required="true" id="is_user_guide" style="width:50px" value="#{userGuideView.newDocument.is_user_guide}"
	        							requiredMessage="The mandatory field #{msg['userGuide_is_user_guide']} must be informed">
										<!-- Con el boton de FileUpload no se actualiza este campo de newDocument. Hay que actualizarlo con ajax. -->
										 <f:selectItem itemLabel="N" itemValue="N" />	
										 <f:selectItem itemLabel="Y" itemValue="Y" />	
			           			</p:selectOneMenu>	
			           			<p:message for="is_user_guide" />		
							</p:column>	
						</p:row>
						
						<p:row>
							<p:column colspan="4" >
								<p:commandButton value="#{msg['cancel']}" style="float:right;"
										actionListener="#{userGuideView.cancelNewDocument}"
										update=":form:msgs,:formNewEntity,:#{p:component('userGuides1')},:#{p:component('type')}"
										onstart="PF('cancelando').show()" immediate="true"
										oncomplete="PF('cancelando').hide();PF('dlgNewDocumentName').hide();" />										
								<p:commandButton value="#{msg['save']}" style="float:right;"
										actionListener="#{userGuideView.saveNewDocument}"
										update=":form:msgs,:formNewEntity,:formNewType,:#{p:component('userGuides1')},:#{p:component('type')}"
										onstart="PF('grabando').show()"
										oncomplete="PF('grabando').hide();PF('dlgNewDocumentName').hide();" />
								</p:column>
						</p:row>
					
					</p:panelGrid>
				</p:panelGrid>
				
				<p:separator/>
							
			</h:form>			
		</p:dialog>
	
	</shiro:hasPermission>


	</ui:define>

</ui:composition>
