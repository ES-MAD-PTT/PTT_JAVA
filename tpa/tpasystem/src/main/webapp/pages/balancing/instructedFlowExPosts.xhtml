<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:shiro="http://shiro.apache.org/tags"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:f="http://java.sun.com/jsf/core"	
	template="/templates/template.xhtml">
	<ui:define name="metadata">
	</ui:define>
	<ui:define name="breadCrumbComponent">
		<p:breadCrumb id="path_page" style="margin-bottom:3px">
			<p:menuitem value="#{msg['menu_home']}" icon="ui-icon fa fa-home" style="bottom: -3px;left: 3px" url="/home.xhtml" />
			<p:menuitem value="#{msg['menu_balancing']}" url="#" />
			<p:menuitem value="#{msg['menu_instructed_flow_ex_post']}" url="/pages/balancing/instructedFlowExPosts.xhtml" />
			
		</p:breadCrumb>
	</ui:define>
	<ui:define name="content">
		<h:form id="form" style="width:100%;height:98%;border-collapse:collapse" fullPage="true">
			<p:growl id="msgs" showDetail="true" life="5000"/>
			
            <p:layout widgetVar="instructedFlowExPostLayout" style="width:100%;height:100%" showEffect="clip"  hideEffect="clip">
				
				<p:layoutUnit position="north" resizable="false" closable="false"
					collapsible="true" id="page_filters">	
					
				<p:panelGrid columns="2" style="width:100%">
					
						<p:panelGrid>
							<p:row>
								<p:column  style="font-weight: bold;">
									<h:outputText value="#{msg['instructedFlowExPost_Shipper_short_name']}" />
								</p:column>
								<p:column  style="font-weight: bold;">
									<h:outputText value="#{msg['instructedFlowExPost_Contract']}" />
								</p:column>
								<p:column style="font-weight: bold;">
									<h:outputText value="#{msg['instructedFlowExPost_Zone_Code']}" />
								</p:column>
								<p:column style="font-weight: bold;">
									<h:outputText value="#{msg['instructedFlowExPost_From']}" />
								</p:column>
								<p:column style="font-weight: bold;">
									<h:outputText value="#{msg['instructedFlowExPost_To']}" />
								</p:column>
							</p:row>
							<p:row>
								
							
								<p:column>
									<p:selectOneMenu id="shipper"  style="width:100px"   value="#{instructedFlowExPostView.filters.idn_user_group}" 
									rendered="#{!instructedFlowExPostView.isShipper()}" >
							       		<f:selectItem itemLabel="" itemValue="" />
        								<f:selectItems value="#{instructedFlowExPostView.shippersFilter.entrySet()}" var="entry" itemValue="#{entry.key}" itemLabel="#{entry.value}" />
        								<p:ajax event="change" update="contract"/>
					           		</p:selectOneMenu>
					           		<h:outputText value="#{instructedFlowExPostView.user.user_group_id}" style="float:left" 
					           			rendered="#{instructedFlowExPostView.isShipper()}"/>
								</p:column>
								
								<p:column>
					               	<p:selectOneMenu id="contract" style="width:100px" value="#{instructedFlowExPostView.filters.idn_contract}" >
										<f:selectItem itemLabel="" itemValue="" />
							            <!-- <f:selectItems value="#{instructedFlowExPostView.contracts.entrySet()}" var="entry" itemValue="#{entry.key}" itemLabel="#{entry.value}" /> -->
							             <f:selectItems value="#{instructedFlowExPostView.contractsSystem.entrySet()}" var="entry" itemValue="#{entry.key}" itemLabel="#{entry.value}" />
					               	</p:selectOneMenu>		
								</p:column>
								<p:column>
					               	<p:selectOneMenu id="zone" style="width:100px" value="#{instructedFlowExPostView.filters.idn_zone}" >
										<f:selectItem itemLabel="" itemValue="" />
							            <f:selectItems value="#{instructedFlowExPostView.getZones(changeSystemView.system).entrySet()}" var="entry" itemValue="#{entry.key}" itemLabel="#{entry.value}" />
					               	</p:selectOneMenu>		
								</p:column>
							
								<p:column>
									<p:calendar id="fecInicio"  size="10" pattern="dd/MM/yyyy" mask="true" value="#{instructedFlowExPostView.filters.startDate}" 
										showOn="button" navigator="true" >
										<p:ajax event="dateSelect" update="fecInicio"></p:ajax>
										<p:ajax event="change" update="fecInicio"></p:ajax>
									</p:calendar>
								</p:column>
								<p:column>
									<p:calendar id="fecFin"  size="10" pattern="dd/MM/yyyy" mask="true" value="#{instructedFlowExPostView.filters.endDate}"
										showOn="button" navigator="true"  >
										<p:ajax event="dateSelect" update="fecFin"></p:ajax>
										<p:ajax event="change" update="fecFin"></p:ajax>
									</p:calendar>
								</p:column>
							</p:row>
						</p:panelGrid>
						<p:panelGrid columns="2" style="float:right;top:0px">
							<shiro:hasPermission name="#{changeSystemView.system}.BALANCING.INSTRUCTED_FLOW.EXPOST.QUERY">
								<p:commandButton value="#{msg['search']}" icon="ui-icon fa fa-search" 
									actionListener="#{instructedFlowExPostView.onSearch}"
									onstart="PF('cargando').show()"
									oncomplete="PF('cargando').hide()" 
									update="msgs,:#{p:component('instructedFlowExPosts1')}"/>
							</shiro:hasPermission>
								
							<p:commandButton  onclick="PF('instructedFlowExPostLayout').toggle('north')" id="header_collapse" icon="fa fa-minus" value="#{msg['minimize']}" title="#{msg['collapse_header']}" />
								
							<shiro:hasPermission name="#{changeSystemView.system}.BALANCING.INSTRUCTED_FLOW.EXPOST.QUERY">									
								<p:commandButton value="#{msg['clear']}"
								actionListener="#{instructedFlowExPostView.onClear}"
								onstart="PF('limpiando').show()"
								oncomplete="PF('limpiando').hide()" 
								process="@this" 
								update="form"/> 
							</shiro:hasPermission>
						</p:panelGrid>
					</p:panelGrid>

				</p:layoutUnit>

				<p:layoutUnit id="table_center_layout" position="center"
					resizable="false" closable="false" collapsible="false">

					<p:dataTable widgetVar="w_instructedFlowExPost1"  id="instructedFlowExPosts1" var="instructedFlowExPost" value="#{instructedFlowExPostView.items}" 
						reflow="true" editable="true" 
						style="margin-bottom:20px;border-collapse:collapse"
					    paginator="true" rows="15"
					    rowsPerPageTemplate="5,10,15,20,25">
							<f:facet name="header">
								<p:outputPanel style="height:25px">
									<p:commandButton id="toggler" type="button" value="Columns" style="float:right" icon="ui-icon-calculator" />
	        						<p:columnToggler datasource="instructedFlowExPosts1" trigger="toggler" style="width:200px"/>
	        						<shiro:hasPermission name="#{changeSystemView.system}.BALANCING.INSTRUCTED_FLOW.EXPOST.ADD">
	        							
		        						<p:commandButton id="new" type="button" value="New"  icon="ui-icon fa fa-save" style="float:right;"
		        							onclick="PF('dlgNewInstructedFlowExPost').show();" >
		        						</p:commandButton>	
	        						</shiro:hasPermission>
								</p:outputPanel>        										          
					        </f:facet>
					      
					    	
					    	<p:column headerText="#{msg['instructedFlowExPost_Gas_Day']}" style="width: 100px;" sortBy="#{instructedFlowExPost.gas_day}" filterMatchMode="contains" filterBy="#{instructedFlowExPost.gas_day}">
					       		<h:outputText value="#{instructedFlowExPost.gas_day}" >
					              				<f:convertDateTime pattern="dd/MM/yyyy" />
					            </h:outputText>
					       </p:column>
					    	
					       <p:column headerText="#{msg['instructedFlowExPost_Shipper_Code']}" style="width: 100px;" sortBy="#{instructedFlowExPost.shipper_code}" filterMatchMode="contains" filterBy="#{instructedFlowExPost.shipper_code}">
					       		<h:outputText value="#{instructedFlowExPost.shipper_code}" />
					       </p:column>
					       
					       <p:column headerText="#{msg['instructedFlowExPost_Shipper_short_name']}" style="width: 100px;" sortBy="#{instructedFlowExPost.shipper_code}" filterMatchMode="contains" filterBy="#{instructedFlowExPost.shipper_code}">
					       		<h:outputText value="#{instructedFlowExPost.shortName}" />
					       </p:column>
					       
					       <p:column headerText="#{msg['instructedFlowExPost_Contract_Code']}" style="width: 100px;" sortBy="#{instructedFlowExPost.contrac_code}" filterMatchMode="contains" filterBy="#{instructedFlowExPost.contrac_code}">
					       		<h:outputText value="#{instructedFlowExPost.contrac_code}" />
					       </p:column>
					       
					       <p:column headerText="#{msg['instructedFlowExPost_Zone_Code']}" style="width: 100px;" sortBy="#{instructedFlowExPost.zone_code}" filterMatchMode="contains" filterBy="#{instructedFlowExPost.zone_code}">
					       		<h:outputText value="#{instructedFlowExPost.zone_code}" />
					       </p:column>
					       
					        <p:column headerText="#{msg['instructedFlowExPost_Concept']}" style="width: 100px;" sortBy="#{instructedFlowExPost.concept}" filterMatchMode="contains" filterBy="#{instructedFlowExPost.contrac_code}">
					       		<h:outputText value="#{instructedFlowExPost.concept}" />
					       </p:column>
					       
					        <p:column headerText="#{msg['instructedFlowExPost_Allocated_Value']}" style="width: 100px;" sortBy="#{instructedFlowExPost.allocated_value}" filterMatchMode="contains" filterBy="#{instructedFlowExPost.allocated_value}">
					       		<h:outputText value="#{instructedFlowExPost.allocated_value}" style="float:right"   >
					       			<f:convertNumber groupingUsed="true" minFractionDigits="4" maxFractionDigits="4"/>
					       			
					       		</h:outputText>	
					       </p:column>
					       
					   </p:dataTable>
				</p:layoutUnit>

			</p:layout>
		</h:form>
		<shiro:hasPermission name="#{changeSystemView.system}.BALANCING.INSTRUCTED_FLOW.EXPOST.ADD">
		<p:dialog widgetVar="dlgNewInstructedFlowExPost" resizable="false"  closable="true" modal="true" appendTo="@(body)" header="New InstructedFlowExPost">
		<!-- Este ajax es para que cunado cierre por el  aspa limpie el formulario
		 <p:ajax event="close" update="formNewEntity"  process="@this" listener="#{instructedFlowExPostView.cancel}" />	-->
			<h:form id="formNewEntity">
				<p:growl id="msgs" showDetail="true" life="5000"/>
				<p:panelGrid columns="4" style="width:100%">
					<p:panelGrid>
						<p:row>
							<p:column>
								<h:outputText value="#{msg['instructedFlowExPost_Gas_Day']}" />
							</p:column>
							<p:column>
							<!-- QUITAMOS La comprobación si la fecha pertenece al periodo con balance cerrado, 
							se debe hacer al pulsar el botón Save (por si alguien cierra el mes mientras estemos en esta pantalla) -->
								<p:calendar required="true" id="gasDay" value="#{instructedFlowExPostView.newInstructedFlowExPost.gas_day}" pattern="dd/MM/yyyy"
									readonlyInput="true"   showOn="button" navigator="true" 
									requiredMessage="The mandatory field #{msg['instructedFlowExPost_Gas_Day']} must be informed" >
									<p:ajax event="dateSelect" update="gasDay,contractCode"></p:ajax>
									<p:ajax event="change" update="gasDay,contractCode"></p:ajax>
								</p:calendar>
								<!--  readonlyInput="true"   mindate="#{(instructedFlowExPostView.firstOpenDay).getTime()}" -->
								<p:message for="gasDay" />
							</p:column>
							<p:column>
								<h:outputText value="#{msg['instructedFlowExPost_Shipper_short_name']}" />
							</p:column>
							<p:column>
								<p:selectOneMenu required="true"  id="shipperCode"  style="width:100px"  value="#{instructedFlowExPostView.newInstructedFlowExPost.idn_user_group}"
								requiredMessage="The mandatory field #{msg['instructedFlowExPost_Shipper_short_name']} must be informed" >
							       		<f:selectItem itemLabel="" itemValue="" />
        								<f:selectItems value="#{instructedFlowExPostView.shippersNew.entrySet()}" var="entry" itemValue="#{entry.key}" itemLabel="#{entry.value}" />
        								<p:ajax update="contractCode"/>
					           		</p:selectOneMenu>	
								<p:message for="shipperCode" />
							</p:column>
						</p:row>
					
						<p:row>
							<p:column>
								<h:outputText value="#{msg['instructedFlowExPost_Contract_Code']}" />
							</p:column>
							<p:column>
			               		<p:selectOneMenu required="true"  id="contractCode" style="width:100px"   value="#{instructedFlowExPostView.newInstructedFlowExPost.idn_contract}" 
			               			requiredMessage="The mandatory field #{msg['instructedFlowExPost_Contract_Code']} must be informed"  >
			               			<f:selectItem itemLabel="" itemValue="" />
							        <f:selectItems value="#{instructedFlowExPostView.contractsNewSystem.entrySet()}" var="entry" itemValue="#{entry.key}" itemLabel="#{entry.value}" />
							        <!-- offshore
							        <f:selectItems value="#{instructedFlowExPostView.contractsNew.entrySet()}" var="entry" itemValue="#{entry.key}" itemLabel="#{entry.value}" /> -->
							        <!--   	<f:selectItems value="#{instructedFlowExPostView.getZones(instructedFlowExPostView.newInstructedFlowExPost).entrySet()}" var="entry" itemValue="#{entry.key}" itemLabel="#{entry.value}" />-->
			               		</p:selectOneMenu>	
								<p:message for="contractCode" />		
							</p:column>
							
							<p:column>
								<h:outputText value="#{msg['instructedFlowExPost_Zone_Code']}" />
							</p:column>
							<p:column>
								<p:selectOneMenu required="true"  id="zoneCode"  style="width:100px"  value="#{instructedFlowExPostView.newInstructedFlowExPost.idn_zone}"
								requiredMessage="The mandatory field #{msg['instructedFlowExPost_Zone_Code']} must be informed" >
							       		<f:selectItem itemLabel="" itemValue="" />
        								<f:selectItems value="#{instructedFlowExPostView.getZones(changeSystemView.system).entrySet()}" var="entry" itemValue="#{entry.key}" itemLabel="#{entry.value}" />
        								<p:ajax update="zoneCode"/>
					           		</p:selectOneMenu>	
								<p:message for="zoneCode" />
							</p:column>
					</p:row>
					<p:row>
							<p:column>
								<h:outputText value="#{msg['instructedFlowExPost_Concept']}" />
							</p:column>
							<p:column>
								<p:selectOneMenu required="true" id="concept" style="width:100px"  value="#{instructedFlowExPostView.newInstructedFlowExPost.idn_nomination_concept}" 
									requiredMessage="The mandatory field #{msg['instructedFlowExPost_Concept']} must be informed"  >
								 	 <f:selectItems value="#{instructedFlowExPostView.concepts.entrySet()}" var="entry" itemValue="#{entry.key}" itemLabel="#{entry.value}" />
					           	</p:selectOneMenu>	
					           	<p:message for="concept" />									
							</p:column>
	
						<p:column>
								<h:outputText value="#{msg['instructedFlowExPost_Allocated_Value']}" />
						</p:column>
						<p:column>
							<p:inputNumber required="true" id="allocatedValue" value="#{instructedFlowExPostView.newInstructedFlowExPost.allocated_value}" size="10"
				 							requiredMessage="The mandatory field #{msg['instructedFlowExPost_Allocated_Value']} must be informed"  
											validatorMessage=" The value of #{msg['instructedFlowExPost_Allocated_Value']} cannot be negative"
											decimalSeparator="." thousandSeparator="," decimalPlaces="4" minValue="0">
											<f:validateLongRange minimum="0"/>
							</p:inputNumber>
							<!--  
							<p:inputText required="true" id="allocatedValue" value="#{instructedFlowExPostView.newInstructedFlowExPost.allocated_value}" maxlength="120"  
								requiredMessage="The mandatory field #{msg['instructedFlowExPost_Allocated_Value']} must be informed"  
								validatorMessage=" The value of #{msg['instructedFlowExPost_Allocated_Value']} cannot be negative">
								<f:validateLongRange minimum="0"/>
							</p:inputText>-->
							<p:message for="allocatedValue" />
						</p:column>
					</p:row>					
						
					</p:panelGrid>
				</p:panelGrid>
				
				<p:separator/>
				<p:panelGrid>
					<p:row>
						<p:column>
							<p:commandButton value="#{msg['save']}" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" validateClient="true"
								action="#{instructedFlowExPostView.save}" update=":#{p:component('instructedFlowExPosts1')},:formNewEntity"
								onstart="PF('cargando').show()"
								oncomplete="PF('dlgNewInstructedFlowExPost').hide(),PF('cargando').hide()" />
								
			        	     <p:commandButton value="#{msg['cancel']}" styleClass="ui-confirmdialog-no" icon="ui-icon-close"
			        	     	update="formNewEntity" process="@this" actionListener="#{instructedFlowExPostView.cancel}"  
			        			oncomplete="PF('dlgNewInstructedFlowExPost').hide()"/>
			        			
						</p:column>					
					</p:row>
				</p:panelGrid>							
			</h:form>			
		</p:dialog>
	</shiro:hasPermission>
	</ui:define>


</ui:composition>
