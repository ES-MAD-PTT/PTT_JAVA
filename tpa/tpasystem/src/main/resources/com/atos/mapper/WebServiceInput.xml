<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.atos.mapper.WebServiceInputMapper">

	<insert id="insertWebServiceInput" useGeneratedKeys="true" keyProperty="webserviceInputId" keyColumn="idn_webservice_input" parameterType="com.atos.beans.WebServiceInputBean">
		insert into tpa_twebservice_input 
			(IDN_WEBSERVICE_INPUT, webservice, input_date, filename, binary_data, xml_data, status, idn_webservice_logger,
	                                        aud_ins_user,
	                                        aud_last_user)
		values
			(tpa_swebservice_input.nextval,
			#{webservice},
			#{inputDate},
			#{filename},
			#{binaryData},
			#{xmlData},
			#{status},
			#{webserviceLogId},
	      #{username},
	      #{username})	  
	</insert>

	<select id="webServiceAcumInventorySave" statementType="CALLABLE" parameterType="com.atos.beans.WebServiceProcBean">
		{call PCK_ACC_TOTAL_INVENTORY.pro_acc_total_inventory(
				#{webserviceInputId,jdbcType=INTEGER,mode=IN},
				#{userId,jdbcType=VARCHAR,mode=IN},
				#{languageCode,jdbcType=VARCHAR,mode=IN},
				#{totalMeasurements,jdbcType=INTEGER,mode=OUT},
				#{savedMeasurements,jdbcType=INTEGER,mode=OUT},
				#{errorCode,jdbcType=INTEGER,mode=OUT},
				#{errorDesc,jdbcType=VARCHAR,mode=OUT})}
	</select>

	<select id="webServiceBaseInventorySave" statementType="CALLABLE" parameterType="com.atos.beans.WebServiceProcBean">
		{call PCK_BASE_INVENTORY.pro_base_inventory(
				#{webserviceInputId,jdbcType=INTEGER,mode=IN},
				#{userId,jdbcType=VARCHAR,mode=IN},
				#{languageCode,jdbcType=VARCHAR,mode=IN},
				#{totalMeasurements,jdbcType=INTEGER,mode=OUT},
				#{savedMeasurements,jdbcType=INTEGER,mode=OUT},
				#{errorCode,jdbcType=INTEGER,mode=OUT},
				#{errorDesc,jdbcType=VARCHAR,mode=OUT})}
	</select>


	<select id="checkIntradayExecution" parameterType="java.math.BigDecimal" resultType="java.math.BigDecimal">

SELECT COUNT(*)
  FROM tpa_tallocation      a,
       tpa_tallocation_type b
WHERE a.idn_pipeline_system = #{idn_system}
   AND a.gas_day = TRUNC(SYSDATE)
   AND a.idn_allocation_type = b.idn_allocation_type
   AND b.type_code = 'INTRADAY'
	
	</select>

</mapper>

